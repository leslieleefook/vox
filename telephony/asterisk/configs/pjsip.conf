; PJSIP Configuration for Vox
; SIP Trunking and LiveKit Bridge

[transport-udp]
type = transport
protocol = udp
bind = 0.0.0.0:5060

[transport-tcp]
type = transport
protocol = tcp
bind = 0.0.0.0:5060

[transport-wss]
type = transport
protocol = wss
bind = 0.0.0.0:5080

; ============== SIP Trunk Configuration ==============
; Replace with your SIP provider settings

[sip-trunk]
type = registration
outbound_auth = sip-trunk-auth
server_uri = sip:${SIP_TRUNK_HOST}
client_uri = sip:${SIP_TRUNK_USER}@${SIP_TRUNK_HOST}
contact_user = ${SIP_TRUNK_USER}
retry_interval = 60
forbidden_retry_interval = 600
auth_rejection_permanent = no

[sip-trunk-auth]
type = auth
auth_type = userpass
username = ${SIP_TRUNK_USER}
password = ${SIP_TRUNK_SECRET}

[sip-trunk-endpoint]
type = endpoint
transport = transport-udp
context = from-external
disallow = all
allow = opus,ulaw,alaw
aors = sip-trunk-aor
auth = sip-trunk-auth
outbound_auth = sip-trunk-auth
from_user = ${SIP_TRUNK_USER}
from_domain = ${SIP_TRUNK_HOST}

[sip-trunk-aor]
type = aor
contact = sip:${SIP_TRUNK_HOST}
qualify_frequency = 60

[sip-trunk-identify]
type = identify
endpoint = sip-trunk-endpoint
match = ${SIP_TRUNK_HOST}

; ============== LiveKit Bridge Configuration ==============
; Bridge to LiveKit SIP Gateway

[livekit-bridge]
type = endpoint
transport = transport-wss
context = from-livekit
disallow = all
allow = opus
aors = livekit-aor
direct_media = no
rtp_symmetric = yes
force_rport = yes
rewrite_contact = yes

[livekit-aor]
type = aor
contact = sip:livekit-sip:5060
qualify_frequency = 30

; ============== Dialplan Hints ==============
; For extension routing

[from-external]
; This context is used for incoming calls from the SIP trunk
; Extensions are handled in extensions.conf
